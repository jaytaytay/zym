{% extends "layouts.html" %}

{% block content %}

  <!-- Page content -->
<!--   <div style="max-width:2000px;margin-top:46px;width:80%">
 -->
<table align="center">
 <td>
    <th style="text-align:center"><h1>{{ recipe.name }}</h1></th>
 </td>
</table>
  	
  <!-- Recipe Table -->

<table class="table table-stdiped table-hover" style="table-layout: auto;white-space: nowrap;">
  <tbody>
    <tr>
      <td width="1">Style</td>
      <td>{{ recipe.style }}</td>
    </tr>
    <tr>
      <td>Abbreviation</td>
      <td>{{ recipe.abbreviation }}</td>
    </tr>
    <tr>
      <td>Iteration</td>
      <td>{{ recipe.iteration }}</td>
    </tr>
    <tr>
      <td>Brewday Date</td>
      <td>{{ recipe.brewday_date.strftime("%-d %b %y") }}</td>
    </tr>
    <tr>
      <td>Batch Size</td>
      <td>{{ recipe.batch_size }}</td>
    </tr>
    <tr>
      <td>Brewer</td>
      <td>{{ recipe.user_id }}</td>
    </tr>
  </tbody>
</table>
<div>
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum

<br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
<br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
<br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
<br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
<br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
<br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
<br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
</div>
<div class="p-3 mb-2 bg-primary text-white text-center" style="position:sticky;top:60px;"><h2>Brewing</h2></div>

<div class="p-3 mb-2 bg-secondary text-white text-center" style="position:sticky;top:140px;"><h3>Boil</h3></div>
<!-- <div class="boil_scroll"> -->
<!-- Flash message for successful boil addition -->

<div id="boil_addition_scroll">
{% with messages = get_flashed_messages(category_filter=['success_boil']) %}

  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-success">
        {{ message }}
      </div>
    {% endfor %}    
  {% endif %}

{% endwith %}
</div>

  <!-- Build table of boil additions, sorted by time -->
<div class="content-section">
  <form method="POST" action="">
    {{  form.hidden_tag() }}
    <fieldset class="form-group">
      <legend class="border-bottom mb-4">Add New Boil Addition</legend>
      <div class="form-group"> 
        {{ form.description.label(class="form-control-label") }}
        {% if form.description.errors %}
          {{ form.description(class="form-control form-control-lg is-invalid") }}
          <div class="invalid-feedback">
            {% for error in form.description.errors%}
              <span>{{ error }}</span>
            {% endfor %}
          </div>
        {% else %}
          {{ form.description(class="form-control form-control-lg") }}
        {% endif %}
      </div>
      <div class="form-group"> 
        {{ form.time.label(class="form-control-label") }}
        {% if form.time.errors %}
          {{ form.time(class="form-control form-control-lg is-invalid") }}
          <div class="invalid-feedback">
            {% for error in form.time.errors%}
              <span>{{ error }}</span>
            {% endfor %}
          </div>
        {% else %}
          {{ form.time(class="form-control form-control-lg") }}
        {% endif %}
      </div>
    </fieldset>
    <div class="form-group"> 
      {{ form.submit(class="btn btn-outline-info") }}
    </div>
  </form>
</div>

<table class="table table-striped table-hover">
      <thead class="thead-dark">
          <tr>
            <th scope="col">Description</th>
            <th scope="col">Time (min)</th>
            <th scope="col">End Time</th>            
            <th scope="col">Countdown Timer</th>
            <th scope="col"></th>
          </tr>
      </thead>
      {% for item in boil_additions %}
          <tr>
            <td>{{ item.description }}</td>
            <td>{{ item.time }}</td>
            {% if item.end_datetime == None %}
              <td>Timer not started</td>
              <td>Timer not started</td>
            {% else %}
              <td>{{ item.end_datetime.strftime("%H:%M:%S") }}</td>   
              <td><div id="timer_{{ item.id }}">tbc...</div></td>
              <td><audio id="audio_{{ item.id }}" preload="auto" controls="false" 
              src="{{ sayit(text=item.description)}}"></audio></td> 
            {% endif %}
          </tr>
      {% endfor %}
  </table>

  <!-- include button to start timer -->
<div class="content-section">
  <form method="POST" action="">
    {{  start_timer_form.hidden_tag() }}
    <div class="form-group"> 
      {{ start_timer_form.submit(class="btn btn-outline-info") }}
    </div>
  </form>
</div>

<div>
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
</div>

<div class="p-3 mb-2 bg-secondary text-white text-center" style="position:sticky;top:140px;"><h3>Chill, Whirlpool & Pitch</h3></div>
<div>
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
</div>

<div class="p-3 mb-2 bg-secondary text-white text-center" style="position:sticky;top:140px;"><h3>Fermentation</h3></div>
<div>
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
</div>


<div>
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum

<br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
<br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
<br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
<br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
<br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
<br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
<br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum
  <br>lorem ipsum

</div>

<script>
// Update the count down every 1 second

function innerTimer(countDownDate, target_element, i, audio_tag) {

    // Get today's date and time
    var now = new Date().getTime();
    var end = new Date(countDownDate).getTime();
    // Find the distance between now and the count down date
    var distance = end - now;

    // Time calculations for days, hours, minutes and seconds
    var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
    var seconds = Math.floor((distance % (1000 * 60)) / 1000);

    // Display the result in the element with id="demo"
    document.getElementById(target_element).innerHTML = hours + "h " + minutes + "m " + seconds + "s ";

    // If the count down is finished, write some text
    if (distance < 0) {
      clearInterval(timers[i]);
      document.getElementById(target_element).innerHTML = "EXPIRED";
      $(audio_tag)[0].play();
    }
  }

// // function to clear flash messages after certain time.
// setTimeout(function() {
//     $('.flash_message_fadeout').fadeOut('fast');
// }, 3000); // <-- time in milliseconds

</script>

<script>
  var timers = [];
  var end_times = [];
  var descriptions = [];
  var ids = [];
</script>

{% for item in boil_additions %}
  <!-- build list of end times, and ids.  -->
  <script>
    end_times.push("{{ item.end_datetime }}");
    ids.push("{{ item.id }}");
  </script>
{% endfor %}

<!-- once built, pass it to the javascript loop function to start timers. -->

<script>
  if (end_times.length > 0) {
    for (var i=0;i < end_times.length; ++i) {
      timers[i] = setInterval(innerTimer, 1000, end_times[i], "timer_" + ids[i], i, "#audio_" + ids[i]);
    }
  }
</script>




<!-- 
{% if scroll %}
<script>
    // document.getElementById('{{ scroll }}').scrollIntoView();
var elmnt = document.getElementById(scroll);
elmnt.scrollIntoView();

</script>
{% endif %} -->

{% endblock content %}